---
title: An Analysis of Premier League in R
author: Yang Song
date: '2017-04-22'
draft: false
type: "post"
thumbnailImagePosition: left
thumbnailImage: "img/premier_league_logo.jpg"
description: "This is a review and discussion on my Machine Learning class project - Mining the Stack Overflow Dataset."
---


The **Premier League** is an English professional league for men's association football clubs. At the top of the English football league system, it is the country's primary football competition. Contested by 20 clubs, it operates on a system of promotion and relegation with the English Football League. Premier League season runs from August to May, Teams play 38 matches each, totalling 380 matches in the season. I have to say that it's my favorite league in the world, I do really enjoy the high competitiveness of Premier League, Also in the video game, it's a wise choice to start your career mode using a Premier League team due to the high transfer budget.



<!--more-->


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Setup

*The soccer data is collected and prepared by James P. Curley (2016). engsoccerdata: English Soccer Data*

### Import and clean the data

```{r, warning = FALSE, message = FALSE, tidy = TRUE}
library(devtools)
#install_github('jalapic/engsoccerdata', username = "jalapic")
library(engsoccerdata)
library(dplyr)
library(tidyr)
library(tidyverse)
library(ggplot2)

df <- as_tibble(england)

# The dataset includes results of all top 4 tier soccer games in England since 1888, In our analysis, We are only interested in the Premier League which started in 1992.
df$date <- as.Date(df$Date, format = "%Y-%m-%d")
pl <- df %>%
  filter(tier == 1, Season >= 1992)
```


### Visulizating some interesting facts

* The followings are the 47 teams that ever played in Premier League for at least one season

```{r, warning = FALSE, message = FALSE}
sort(unique(pl$home))
```

* which clubs have never been relegated from the league ?

```{r, warning = FALSE, message = FALSE}

pl_team <- pl %>%
       group_by(home) %>%
       summarize(appearence = n_distinct(Season))

pl_team %>%
  mutate(home = reorder(home, appearence)) %>%
  top_n(15) %>%
  ggplot(aes(x = reorder(home, -appearence), y = appearence)) +
  geom_bar(stat = 'identity', fill = 'lightblue', color = 'black') +
  theme(axis.text.x=element_text(angle=45, hjust=1)) +
  xlab('Club') +
  ylab('Season') +
  ggtitle('Total Seasons in Premier League')

```

Since the start of the Premier League, seven clubs have never faced the drop: They are **Arsenal, Aston Villa, Chelsea, Everton, Liverpool, Man Utd and Hotspur**. Hopefully, we could see Newcastle United in the next season !



* Ranking of each club in the past 25 years

```{r, warning = FALSE, message = FALSE}
pl_rank <- pl %>%
           mutate(home_team_point = ifelse(hgoal > vgoal, 3, ifelse(hgoal == vgoal, 1, 0))) %>%
           mutate(away_team_point = ifelse(vgoal > hgoal, 3, ifelse(hgoal == vgoal, 1, 0)))
temp1 <-  pl_rank %>%
           group_by(Season, home) %>%
           summarize(home_points = sum(home_team_point))
temp2 <- pl_rank %>%
          group_by(Season, visitor) %>%
          summarize(away_points = sum(away_team_point))
temp1$away_points <- temp2$away_points
pl_rank <- temp1 %>%
           mutate(total_points = home_points + away_points)

pl_rank <- pl_rank %>%
           rename(Team = home) %>%
           group_by(Season) %>%
           arrange(-total_points) %>%
           mutate(ranking = row_number())

# We only include some famous football clubs in the visulization

pl_rank  %>%
    filter(Team %in% c('Arsenal','Chelsea','Everton',
                        'Liverpool','Manchester City','Manchester United',
                        'Tottenham Hotspur', 'Leicester City')) %>%
    ggplot(aes(x = Season, y = ranking, group = Team, colour = Team)) +
    geom_line(size = 1) +
    geom_point() +
    scale_x_continuous(breaks=seq(1992,2015,1)) +
    theme(axis.text.x=element_text(angle=45, hjust=1)) +
    xlab('Year') +
    ylab('Standing') +
    ggtitle('Top Team Standing') +
    theme(legend.position="bottom")


```



* Which club has the longest consecutive winning / losing runs

```{r, warning = FALSE, message = FALSE, tidy = TRUE}

```


## Analysis



## Conclusion
